<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<title>Shoe Tracker</title>

<style>
* { box-sizing: border-box; }

body {
margin: 0;
padding: 12px;
background: #000;
color: #fff;
font-family: -apple-system, BlinkMacSystemFont, sans-serif;
max-width: 480px;
margin-left: auto;
margin-right: auto;
}

h1 {
text-align: center;
color: #39ff14;
}

.card {
background: #111;
border-radius: 14px;
padding: 12px;
margin-bottom: 12px;
}

input, select {
width: 100%;
padding: 10px;
border-radius: 8px;
border: none;
margin-bottom: 8px;
background: #333;
color: #fff;
font-size: 16px;
}

button {
width: 100%;
padding: 12px;
border-radius: 10px;
border: none;
background: #39ff14;
color: #000;
font-weight: bold;
font-size: 16px;
cursor: pointer;
}

button.secondary {
background: #222;
color: #fff;
margin-top: 6px;
}

.tiles {
display: flex;
gap: 6px;
margin-bottom: 8px;
}

.tiles button {
flex: 1;
padding: 10px;
}

.run {
background: #1a1a1a;
border-radius: 10px;
padding: 10px;
margin-bottom: 8px;
font-size: 14px;
}

.small {
font-size: 13px;
opacity: 0.8;
}

.actions {
display: flex;
gap: 6px;
margin-top: 6px;
}

.actions button {
flex: 1;
padding: 6px;
font-size: 13px;
}

.hidden { display: none; }
</style>
</head>

<body>

<h1>Shoe Tracker</h1>

<div class="card">
<h3>Dodaj bieg</h3>

<div class="tiles">
<button onclick="setDistance(5)">5</button>
<button onclick="setDistance(10)">10</button>
<button onclick="setDistance(15)">15</button>
<button onclick="setDistance(20)">20</button>
</div>

<input id="distance" type="number" step="0.01" placeholder="Dystans (km)">
<input id="time" placeholder="Czas (hh:mm:ss lub mm:ss)">
<select id="shoeSelect"></select>

<button onclick="addRun()">Dodaj bieg</button>
</div>

<div class="card">
<button class="secondary" onclick="toggleShoeForm()">➕ Dodaj buty</button>
<div id="shoeForm" class="hidden">
<input id="newShoe" placeholder="Nazwa butów">
<button onclick="addShoe()">Zapisz</button>
</div>
</div>

<div class="card">
<h3>Biegi</h3>

<select id="sortSelect" onchange="renderRuns()">
<option value="newest">Najnowsze</option>
<option value="fastest">Najszybsze tempo</option>
<option value="slowest">Najwolniejsze tempo</option>
</select>

<div id="runs"></div>

<button class="secondary" id="toggleRunsBtn" onclick="toggleRuns()">Pokaż więcej</button>
</div>

<div class="card">
<h3>Dane</h3>
<button class="secondary" onclick="exportData()">Eksportuj</button>
<input type="file" id="importFile" class="hidden" accept=".json">
<button class="secondary" onclick="importFile.click()">Importuj</button>
</div>

<script>
let shoes = JSON.parse(localStorage.getItem("shoes")) || ["Nike Vomero Plus", "Nike AlphaFly 3"];
let runs = JSON.parse(localStorage.getItem("runs")) || [];
let showAllRuns = false;

function save() {
localStorage.setItem("shoes", JSON.stringify(shoes));
localStorage.setItem("runs", JSON.stringify(runs));
}

function setDistance(v) { distance.value = v; }

function parseTime(t) {
const p = t.split(":").map(Number);
if (p.length === 2) return p[0]*60 + p[1];
if (p.length === 3) return p[0]*3600 + p[1]*60 + p[2];
return 0;
}

function formatTime(sec) {
const h = Math.floor(sec/3600);
const m = Math.floor((sec%3600)/60);
const s = sec % 60;
return h ? `${h}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}` : `${m}:${String(s).padStart(2,"0")}`;
}

function formatPace(secKm) {
const m = Math.floor(secKm/60);
const s = Math.round(secKm%60);
return `${m}:${String(s).padStart(2,"0")}`;
}

function updateShoes() {
shoeSelect.innerHTML = "";
shoes.forEach(s => {
const o = document.createElement("option");
o.textContent = s;
if (s === "Nike Vomero Plus") o.selected = true;
shoeSelect.appendChild(o);
});
}

function addRun() {
const d = parseFloat(distance.value);
const t = parseTime(time.value);
if (!d || !t) return alert("Nieprawidłowe dane");

runs.unshift({ distance:d, time:t, shoe:shoeSelect.value, pace:t/d });
save();
renderRuns();
distance.value = "";
time.value = "";
}

function renderRuns() {
const list = [...runs];
const sort = sortSelect.value;

if (sort === "fastest") list.sort((a,b)=>a.pace-b.pace);
if (sort === "slowest") list.sort((a,b)=>b.pace-a.pace);

const visible = showAllRuns ? list : list.slice(0,3);
runs.innerHTML = "";

visible.forEach((r,i)=>{
const div = document.createElement("div");
div.className = "run";
div.innerHTML = `
${r.distance} km • ${formatTime(r.time)} • ${formatPace(r.pace)} min/km<br>
<span class="small">${r.shoe}</span>
<div class="actions">
<button onclick="deleteRun(${i})">Usuń</button>
</div>`;
runs.appendChild(div);
});

toggleRunsBtn.textContent = showAllRuns ? "Pokaż mniej" : "Pokaż więcej";
toggleRunsBtn.style.display = runs.length > 3 ? "block" : "none";
}

function toggleRuns() {
showAllRuns = !showAllRuns;
renderRuns();
}

function deleteRun(i) {
if (!confirm("Usunąć bieg?")) return;
runs.splice(i,1);
save();
renderRuns();
}

function toggleShoeForm() {
shoeForm.classList.toggle("hidden");
}

function addShoe() {
if (!newShoe.value.trim()) return;
shoes.push(newShoe.value.trim());
newShoe.value = "";
save();
updateShoes();
shoeForm.classList.add("hidden");
}

function exportData() {
const blob = new Blob([JSON.stringify({shoes,runs},null,2)],{type:"application/json"});
const a = document.createElement("a");
a.href = URL.createObjectURL(blob);
a.download = "shoe-tracker-backup.json";
a.click();
}

importFile.addEventListener("change",e=>{
const r = new FileReader();
r.onload=()=>{
const d = JSON.parse(r.result);
shoes=d.shoes; runs=d.runs;
save(); updateShoes(); renderRuns();
};
r.readAsText(e.target.files[0]);
});

updateShoes();
renderRuns();
</script>

</body>
</html>
