<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Shoe Tracker</title>
<style>
* { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
body { margin:0; padding:10px; max-width:480px; margin-left:auto; margin-right:auto; background:#000; color:#fff; }
h1 { text-align:center; color:#39ff14; margin-bottom:20px; }
.card { background:#141414; border-radius:18px; padding:18px; margin-bottom:18px; }
label { display:block; margin-top:12px; font-size:16px; opacity:0.9; }
input, select { width:100%; max-width:100%; margin-top:8px; padding:14px; border-radius:12px; border:none; background:#1f1f1f; color:#fff; font-size:16px; }
button { width:100%; margin-top:16px; padding:16px; border-radius:14px; border:none; background:#39ff14; color:#000; font-size:18px; font-weight:600; cursor:pointer; }
.outline-btn { background:transparent; border:2px solid #39ff14; color:#39ff14; padding:14px; font-size:17px; border-radius:14px; margin-bottom:16px; cursor:pointer; }
.hidden { display:none; }
.shoe-stat { margin-top:14px; }
.shoe-name { color:#39ff14; font-weight:600; margin-bottom:4px; }
.settings-btn { background:transparent; border:2px solid #39ff14; color:#39ff14; padding:14px; font-size:17px; border-radius:14px; margin-top:16px; cursor:pointer; }
.danger { background:#2a0000; color:#ff5c5c; border:1px solid #ff5c5c; }
.run-item { background:#1f1f1f; padding:12px; margin:6px 0; border-radius:12px; display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; }
.run-info { flex:1; }
.run-buttons button { margin-left:6px; padding:6px 10px; font-size:14px; cursor:pointer; }
.distance-tiles { display:flex; gap:8px; margin-top:8px; }
.distance-tiles button { flex:1; padding:10px; font-size:16px; border-radius:12px; background:#1f1f1f; color:#fff; border:none; cursor:pointer; }
.distance-tiles button:hover { background:#39ff14; color:#000; }
.show-all-btn { margin-top:10px; padding:10px; font-size:16px; border-radius:12px; background:#1f1f1f; color:#39ff14; border:none; cursor:pointer; }
.show-all-btn:hover { background:#39ff14; color:#000; }
.sort-btn { margin-top:10px; padding:10px; font-size:16px; border-radius:12px; background:#1f1f1f; color:#39ff14; border:none; cursor:pointer; }
.sort-btn:hover { background:#39ff14; color:#000; }
</style>
</head>

<body>
<h1>SHOE TRACKER</h1>

<button class="outline-btn" onclick="toggleShoeForm()">+ Dodaj nowe buty</button>
<div id="shoeForm" class="card hidden">
  <label>Nazwa butów</label>
  <input id="newShoeName" placeholder="np. Nike AlphaFly 3">
  <button onclick="addShoe()">Dodaj buty</button>
</div>

<div class="card">
  <label>Dystans (km)</label>
  <div class="distance-tiles">
    <button onclick="setDistance(5)">5</button>
    <button onclick="setDistance(10)">10</button>
    <button onclick="setDistance(15)">15</button>
    <button onclick="setDistance(20)">20</button>
  </div>
  <input id="distance" type="number" step="0.01" placeholder="Wpisz dystans">

  <label>Czas (mm:ss)</label>
  <input id="time" placeholder="np. 45:30">

  <label>Buty</label>
  <select id="shoeSelect"></select>

  <button onclick="addRun()">Dodaj bieg</button>
</div>

<div class="card">
  <h2>Statystyki butów</h2>
  <div id="stats"></div>
  <h3>Lista biegów</h3>
  <button class="sort-btn" onclick="toggleSort()">Sortuj po tempie</button>
  <div id="runList"></div>
  <button id="toggleShowAll" class="show-all-btn hidden" onclick="toggleShowAll()">Pokaż wszystkie biegi</button>
</div>

<button class="settings-btn" onclick="toggleSettings()">⚙️ Ustawienia</button>
<div id="settings" class="card hidden">
  <button class="danger" onclick="resetRuns()">Wyczyść wszystkie biegi</button>
</div>

<script>
let shoes = JSON.parse(localStorage.getItem("shoes")) || ["Nike Vomero Plus"];
let runs = JSON.parse(localStorage.getItem("runs")) || [];
let showAll = false;
let sortByPace = false;

function save() { localStorage.setItem("shoes", JSON.stringify(shoes)); localStorage.setItem("runs", JSON.stringify(runs)); }
function toggleShoeForm() { document.getElementById("shoeForm").classList.toggle("hidden"); }
function toggleSettings() { document.getElementById("settings").classList.toggle("hidden"); }
function setDistance(val) { document.getElementById("distance").value = val; }

function addShoe() {
  const name = document.getElementById("newShoeName").value.trim();
  if(!name) return;
  shoes.push(name);
  document.getElementById("newShoeName").value = "";
  save(); updateUI();
}

function parseTime(str) {
  const parts = str.split(":").map(Number);
  if(parts.length!==2 || parts.some(isNaN)) return null;
  return parts[0]*60 + parts[1];
}

function formatTime(sec) {
  let s=Math.floor(sec), min=Math.floor(s/60), hrs=Math.floor(min/60), days=Math.floor(hrs/24), months=Math.floor(days/30);
  s%=60; min%=60; hrs%=24; days%=30;
  return `${months}m ${days}d ${hrs}h ${min}m ${s}s`;
}

function formatPace(secPerKm) {
  const min=Math.floor(secPerKm/60);
  const sec=Math.round(secPerKm - min*60);
  return `${min}:${sec.toString().padStart(2,'0')} min/km`;
}

function addRun(editIndex=null) {
  const distance=parseFloat(document.getElementById("distance").value);
  const timeStr=document.getElementById("time").value;
  const shoe=document.getElementById("shoeSelect").value;
  const seconds=parseTime(timeStr);
  if(!distance || !seconds || !shoe) return;

  if(editIndex!==null) {
    runs[editIndex]={distance, seconds, shoe, date:runs[editIndex].date};
  } else {
    runs.push({distance, seconds, shoe, date:Date.now()});
  }

  save(); updateUI();
  document.getElementById("distance").value=""; 
  document.getElementById("time").value="";
}

function deleteRun(index) { runs.splice(index,1); save(); updateUI(); }

function editRun(index){
  const run=runs[index];
  document.getElementById("distance").value=run.distance;
  document.getElementById("time").value=`${Math.floor(run.seconds/60)}:${(run.seconds%60).toString().padStart(2,'0')}`;
  document.getElementById("shoeSelect").value=run.shoe;
  addRun.editIndex=index;
}

function resetRuns() { if(!confirm("Na pewno usunąć wszystkie biegi?")) return; runs=[]; save(); updateUI(); }

function toggleShowAll() { showAll=!showAll; updateUI(); }

function toggleSort() { sortByPace=!sortByPace; updateUI(); }

function updateUI() {
  const select=document.getElementById("shoeSelect"); 
  select.innerHTML="";
  shoes.forEach(s=>{ const opt=document.createElement("option"); opt.textContent=s; select.appendChild(opt); });
  if(!select.value) select.value="Nike Vomero Plus";

  // Statystyki
  const stats=document.getElementById("stats"); stats.innerHTML="";
  shoes.forEach(shoe=>{
    const shoeRuns=runs.filter(r=>r.shoe===shoe);
    if(!shoeRuns.length) return;
    const totalDist=shoeRuns.reduce((a,r)=>a+r.distance,0);
    const totalTime=shoeRuns.reduce((a,r)=>a+r.seconds,0);
    const avgPace=totalTime/totalDist;
    const div=document.createElement("div"); div.className="shoe-stat";
    div.innerHTML=`<div class="shoe-name">${shoe}</div>
        Dystans: ${totalDist.toFixed(1)} km<br>
        Czas wybiegany: ${formatTime(totalTime)}<br>
        Średnie tempo: ${formatPace(avgPace)}`;
    stats.appendChild(div);
  });

  // Lista biegów
  const runList=document.getElementById("runList"); runList.innerHTML="";
  let sortedRuns=[...runs];
  if(sortByPace) {
    sortedRuns.sort((a,b)=>(a.seconds/a.distance)-(b.seconds/b.distance));
  } else {
    sortedRuns.sort((a,b)=>b.date - a.date);
  }
  const displayRuns=showAll ? sortedRuns : sortedRuns.slice(0,3);
  displayRuns.forEach((r)=>{
    const index=runs.indexOf(r);
    const pace=formatPace(r.seconds/r.distance);
    const div=document.createElement("div"); div.className="run-item";
    div.innerHTML=`
        <div class="run-info">
            ${r.distance} km, ${Math.floor(r.seconds/60)}:${(r.seconds%60).toString().padStart(2,'0')} min, ${r.shoe}, tempo: ${pace}
        </div>
        <div class="run-buttons">
            <button onclick="editRun(${index}); addRun.editIndex=${index}">Edytuj</button>
            <button onclick="deleteRun(${index})">Usuń</button>
        </div>
    `;
    runList.appendChild(div);
  });

  const toggleBtn=document.getElementById("toggleShowAll");
  toggleBtn.classList.toggle("hidden", runs.length<=3);
  toggleBtn.textContent=showAll?"Pokaż mniej":"Pokaż wszystkie biegi";
}
updateUI();
</script>
</body>
</html>
